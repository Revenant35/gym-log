<ion-header>
  <ion-toolbar>
    <ion-title>Current Schedule</ion-title>
    <ion-buttons slot="end">
      <ion-button [routerLink]="['/schedules']">
        <ion-icon slot="icon-only" name="calendar-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="schedule-container">
    @if (schedule.isLoading()) {
      <div class="loading-container">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Loading schedule...</p>
      </div>
    } @else {
      @if (schedule.error(); as error) {
        <div class="error-container">
          <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
          <h3>Error Loading Schedule</h3>
          <p>{{ error?.message || 'An unexpected error occurred' }}</p>
          <ion-button fill="outline" (click)="schedule.reload()">
            <ion-icon slot="start" name="refresh-outline"></ion-icon>
            Retry
          </ion-button>
        </div>
      }

      @if (schedule.hasValue()) {
        @if (schedule.value(); as s){
          <app-schedule-day-of-week-picker
            [schedule]="s"
            [(selectedDay)]="selectedDay"/>

          <app-day-of-week-navigator
            [(selectedDay)]="selectedDay" />

          @if (s.days[selectedDay()]; as workout) {
            <div class="workout-content">
              <div class="workout-header">
                <h3 class="workout-name">{{ workout.name }}</h3>
                <p class="exercise-count">{{ workout.exercises.length }} exercises</p>
              </div>

              <div class="exercises-list">
                @for (exercise of workout.exercises; track $index) {
                  <app-exercise-info-card [exercise]="exercise"></app-exercise-info-card>
                }
              </div>

              <div class="action-button-container">
                <ion-button expand="block" size="large" [routerLink]="['/workout']">
                  <ion-icon slot="start" name="barbell-outline"></ion-icon>
                  Start Workout
                </ion-button>
              </div>
            </div>
          } @else {
            <div class="rest-day">
              <ion-icon name="moon-outline" class="rest-icon"></ion-icon>
              <h3>Rest Day</h3>
              <p>No workout scheduled for {{ selectedDay() }}</p>
              <ion-button fill="outline" [routerLink]="['/schedules']">
                View All Schedules
              </ion-button>
            </div>
          }
        }
      }
    }
  </div>
</ion-content>
